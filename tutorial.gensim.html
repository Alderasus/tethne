<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">
    
    <title>Tethne and Gensim &mdash; tethne 0.8 documentation</title>
    
    <link rel="stylesheet" type="text/css" href="_static/css/spc-bootstrap.css">
    <link rel="stylesheet" type="text/css" href="_static/css/spc-extend.css">
    <link rel="stylesheet" href="_static/scipy.css" type="text/css" >
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" >
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.8',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/copybutton.js"></script>
    <link rel="top" title="tethne 0.8 documentation" href="index.html" >
    <link rel="next" title="tethne package" href="tethne.html" >
    <link rel="prev" title="Generating and Visualizing Topic Models with Tethne and MALLET" href="tutorial.mallet.html" > 
  </head>
  <body>

<div class="container">
  <div class="top-scipy-org-logo-header">
    <a href="index.html">
      <img style="border: 0; height: 60px;" alt="SciPy" src="_static/img/logo_long_devo.png"></a>
    </div>
  </div>
</div>


    <div class="container">
      <div class="main">
        
	<div class="row-fluid">
	  <div class="span12">
	    <div class="spc-navbar">
              
    <ul class="nav nav-pills pull-left">
        <li class="active"><a href="http://diging.github.io/tethne/">Tethne</a></li>
	
        <li class="active"><a href="index.html">tethne 0.8 documentation</a></li>
	 
    </ul>
              
              
    <ul class="nav nav-pills pull-right">
      <li class="active">
        <a href="genindex.html" title="General Index"
           accesskey="I">index</a>
      </li>
      <li class="active">
        <a href="py-modindex.html" title="Python Module Index"
           >modules</a>
      </li>
      <li class="active">
        <a href="tethne.html" title="tethne package"
           accesskey="N">next</a>
      </li>
      <li class="active">
        <a href="tutorial.mallet.html" title="Generating and Visualizing Topic Models with Tethne and MALLET"
           accesskey="P">previous</a>
      </li>
    </ul>
              
	    </div>
	  </div>
	</div>
        

	<div class="row-fluid">
          <div class="span9">
            
        <div class="bodywrapper">
          <div class="body" id="spc-section-body">
              <strong style="color: #0088cc;">
                  Need help? Have a feature request? Please check out the
                  <a href="https://groups.google.com/forum/?utm_medium=email&utm_source=footer#!forum/tethne-users">
                      tethne-users group
                  </a>.
              </strong>
            
  <div class="section" id="tethne-and-gensim">
<span id="gensim-tutorial"></span><h1>Tethne and Gensim<a class="headerlink" href="#tethne-and-gensim" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://radimrehurek.com/gensim/">Gensim</a> is a lovely package for topic
modeling in Python. As of v0.8.1 there are a few ways to use Tethne and Gensim
together for fun or profit.</p>
<div class="section" id="export-a-gensim-friendly-bag-of-words-corpus">
<h2>Export a Gensim-friendly bag-of-words corpus<a class="headerlink" href="#export-a-gensim-friendly-bag-of-words-corpus" title="Permalink to this headline">¶</a></h2>
<p>Both <a class="reference internal" href="tethne.classes.html#tethne.classes.feature.FeatureSet" title="tethne.classes.feature.FeatureSet"><code class="xref py py-class docutils literal"><span class="pre">FeatureSet</span></code></a> and <a class="reference internal" href="tethne.classes.html#tethne.classes.feature.StructuredFeatureSet" title="tethne.classes.feature.StructuredFeatureSet"><code class="xref py py-class docutils literal"><span class="pre">StructuredFeatureSet</span></code></a> now have methods
called <code class="docutils literal"><span class="pre">to_gensim_corpus()</span></code> that can generate a bag-of-words representation
usable in Gensim&#8217;s LDA and LSI (LSA) models.</p>
<p>Suppose you want to topic model (in Gensim) abstracts from a Web of Science
collection. Here&#8217;s a fairly typical approach to generating a
<a class="reference internal" href="tethne.classes.html#tethne.classes.feature.StructuredFeatureSet" title="tethne.classes.feature.StructuredFeatureSet"><code class="xref py py-class docutils literal"><span class="pre">StructuredFeatureSet</span></code></a> from abstracts:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">tethne.readers.wos</span> <span class="kn">import</span> <span class="n">read</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">corpus</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="s1">&#39;/path/to/my/data&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">nltk.tokenize</span> <span class="kn">import</span> <span class="n">word_tokenize</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">corpus</span><span class="o">.</span><span class="n">index_feature</span><span class="p">(</span><span class="s1">&#39;abstract&#39;</span><span class="p">,</span> <span class="n">word_tokenize</span><span class="p">,</span> <span class="n">structured</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>At this point you might do some filtering or transformation (see
<a class="reference internal" href="tutorial.mallet.html#mallet-tutorial"><span class="std std-ref">Generating and Visualizing Topic Models with Tethne and MALLET</span></a>).</p>
<p>Gensim&#8217;s :class`gensim.models.ldamodel.LdaModel` requires a &#8220;corpus&#8221; in
&#8220;bag of words&#8221; format. This is just a list of lists, in which each sub-list is
a sequence of (token, count) tuples for a particular document (see <a class="reference external" href="https://radimrehurek.com/gensim/tut1.html#from-strings-to-vectors">the Gensim
documentation</a> for more
details). Gensim also needs a vocabulary (<code class="docutils literal"><span class="pre">id2word</span></code>), that is just a dict
that maps integer keys to string representations of the words in your corpus.</p>
<p>Et voila:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gensim_corpus</span><span class="p">,</span> <span class="n">id2word</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_gensim_corpus</span><span class="p">()</span>
</pre></div>
</div>
<p>You can pass these objects directly to <code class="docutils literal"><span class="pre">LdaModel</span></code>. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ldamodel</span><span class="o">.</span><span class="n">LdaModel</span><span class="p">(</span><span class="n">corpus</span><span class="o">=</span><span class="n">gensim_corpus</span><span class="p">,</span> <span class="n">id2word</span><span class="o">=</span><span class="n">id2word</span><span class="p">,</span>
<span class="go">                                     num_topics=20, update_every=1,</span>
<span class="go">                                     chunksize=10000, passes=1)</span>
</pre></div>
</div>
<p>This works basically the same for both
<a class="reference internal" href="tethne.classes.html#tethne.classes.feature.StructuredFeatureSet.to_gensim_corpus" title="tethne.classes.feature.StructuredFeatureSet.to_gensim_corpus"><code class="xref py py-meth docutils literal"><span class="pre">StructuredFeatureSet.to_gensim_corpus()</span></code></a> and
<a class="reference internal" href="tethne.classes.html#tethne.classes.feature.FeatureSet.to_gensim_corpus" title="tethne.classes.feature.FeatureSet.to_gensim_corpus"><code class="xref py py-meth docutils literal"><span class="pre">FeatureSet.to_gensim_corpus()</span></code></a>.</p>
</div>
<div class="section" id="export-a-raw-text-corpus">
<h2>Export a raw text corpus<a class="headerlink" href="#export-a-raw-text-corpus" title="Permalink to this headline">¶</a></h2>
<p>If you would rather start with the document structure described in <a class="reference external" href="https://radimrehurek.com/gensim/tut1.html">this
tutorial</a> (i.e. each document is
a list of strings), you can pass <code class="docutils literal"><span class="pre">raw=False</span></code> to <code class="docutils literal"><span class="pre">to_gensim_corpus()</span></code>. It
will return a (corpus, vocabulary) tuple, except that <code class="docutils literal"><span class="pre">vocabulary</span></code> here is
<code class="docutils literal"><span class="pre">None</span></code> so yar can discard it.</p>
<p>This can be useful if you are using Gensim&#8217;s <a class="reference external" href="https://radimrehurek.com/gensim/models/phrases.html">phrase detection</a> model. Note, however,
that this really only makes sense for <a class="reference internal" href="tethne.classes.html#tethne.classes.feature.StructuredFeatureSet" title="tethne.classes.feature.StructuredFeatureSet"><code class="xref py py-class docutils literal"><span class="pre">StructuredFeatureSet</span></code></a>s, since
(by definition) <a class="reference internal" href="tethne.classes.html#tethne.classes.feature.FeatureSet" title="tethne.classes.feature.FeatureSet"><code class="xref py py-class docutils literal"><span class="pre">FeatureSet</span></code></a>s do not preserve order.</p>
</div>
<div class="section" id="let-tethne-talk-to-gensim">
<h2>Let Tethne talk to Gensim<a class="headerlink" href="#let-tethne-talk-to-gensim" title="Permalink to this headline">¶</a></h2>
<p>Tethne also provides a wrapper for Gensim, <code class="xref py py-class docutils literal"><span class="pre">GensimLDAModel</span></code>, which has
a nearly identical API to the MALLET-backed <a class="reference internal" href="tethne.model.corpus.html#tethne.model.corpus.mallet.LDAModel" title="tethne.model.corpus.mallet.LDAModel"><code class="xref py py-class docutils literal"><span class="pre">LDAModel</span></code></a> described in
<a class="reference internal" href="tutorial.mallet.html#mallet-tutorial"><span class="std std-ref">Generating and Visualizing Topic Models with Tethne and MALLET</span></a>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">tethne</span> <span class="kn">import</span> <span class="n">GensimLDAModel</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">GensimLDAModel</span><span class="p">(</span><span class="n">corpus</span><span class="p">,</span> <span class="n">featureset_name</span><span class="o">=</span><span class="s1">&#39;abstract&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Z</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<p>Pretty much anything that you can do with <a class="reference internal" href="tethne.model.corpus.html#tethne.model.corpus.mallet.LDAModel" title="tethne.model.corpus.mallet.LDAModel"><code class="xref py py-class docutils literal"><span class="pre">LDAModel</span></code></a> (e.g. building
topic-based graphs) you can also do with <code class="xref py py-class docutils literal"><span class="pre">GensimLDAModel</span></code>.</p>
</div>
<div class="section" id="load-phi-or-theta-from-a-gensim-ldamodel-as-featuresets">
<h2>Load <code class="docutils literal"><span class="pre">phi</span></code> or <code class="docutils literal"><span class="pre">theta</span></code> from a Gensim <code class="docutils literal"><span class="pre">LdaModel</span></code> as <code class="docutils literal"><span class="pre">FeatureSet</span></code>s<a class="headerlink" href="#load-phi-or-theta-from-a-gensim-ldamodel-as-featuresets" title="Permalink to this headline">¶</a></h2>
<p>If you have already fit your model with Gensim, and simply want to work with
the results as a <a class="reference internal" href="tethne.classes.html#tethne.classes.feature.FeatureSet" title="tethne.classes.feature.FeatureSet"><code class="xref py py-class docutils literal"><span class="pre">FeatureSet</span></code></a> (e.g. to create a graph), you can use
<code class="xref py py-func docutils literal"><span class="pre">gensim_to_theta_featureset()</span></code> and <code class="xref py py-func docutils literal"><span class="pre">gensim_to_phi_featureset()</span></code> to
load document-topic and topic-word assignments.</p>
<p>For example, suppose that you want to build a topic-cooccurrence graph. In the
code block below, <code class="docutils literal"><span class="pre">ldamodel</span></code> is a <code class="xref py py-class docutils literal"><span class="pre">gensim.models.ldamodel.LdaModel</span></code>,
and <code class="docutils literal"><span class="pre">corpus</span></code> is the bag-of-words corpus that you used to create the
<code class="docutils literal"><span class="pre">LdaModel</span></code>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">tethne</span> <span class="kn">import</span> <span class="n">gensim_to_theta_featureset</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">theta</span> <span class="o">=</span> <span class="n">gensim_to_theta_featureset</span><span class="p">(</span><span class="n">ldamodel</span><span class="p">,</span> <span class="n">corpus</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">tethne</span> <span class="kn">import</span> <span class="n">feature_cooccurrence</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">graph</span> <span class="o">=</span> <span class="n">feature_cooccurrence</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">min_weight</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
</pre></div>
</div>
<p>If you instead wanted to work with topic-word assignments, you would use
<code class="xref py py-func docutils literal"><span class="pre">gensim_to_phi_featureset()</span></code>. This function does not require <code class="docutils literal"><span class="pre">corpus</span></code>,
so it&#8217;s as simple as:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">tethne</span> <span class="kn">import</span> <span class="n">gensim_to_phi_featureset</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">theta</span> <span class="o">=</span> <span class="n">gensim_to_theta_featureset</span><span class="p">(</span><span class="n">ldamodel</span><span class="p">)</span>
</pre></div>
</div>
<p>And then you can build, say, a term-coassignment graph like so (you may want to
use <a href="#id1"><span class="problematic" id="id2">:prop:`.FeatureSet.norm`</span></a> here, keeping in mind that the resulting values
are no longer the phi posterior probabilities but rather relative probabilities
within a topic).</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">tethne</span> <span class="kn">import</span> <span class="n">feature_cooccurrence</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">graph</span> <span class="o">=</span> <span class="n">feature_cooccurrence</span><span class="p">(</span><span class="n">phi</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span> <span class="n">min_weight</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
          </div>
      <div class="spc-rightsidebar span3">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo_round.png" alt="Logo">
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tethne and Gensim</a><ul>
<li><a class="reference internal" href="#export-a-gensim-friendly-bag-of-words-corpus">Export a Gensim-friendly bag-of-words corpus</a></li>
<li><a class="reference internal" href="#export-a-raw-text-corpus">Export a raw text corpus</a></li>
<li><a class="reference internal" href="#let-tethne-talk-to-gensim">Let Tethne talk to Gensim</a></li>
<li><a class="reference internal" href="#load-phi-or-theta-from-a-gensim-ldamodel-as-featuresets">Load <code class="docutils literal"><span class="pre">phi</span></code> or <code class="docutils literal"><span class="pre">theta</span></code> from a Gensim <code class="docutils literal"><span class="pre">LdaModel</span></code> as <code class="docutils literal"><span class="pre">FeatureSet</span></code>s</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="tutorial.mallet.html"
                        title="previous chapter">Generating and Visualizing Topic Models with Tethne and MALLET</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="tethne.html"
                        title="next chapter">tethne package</a></p>
  <h3>This Page</h3>
  <div>
    <a href="_sources/tutorial.gensim.txt"
       rel="nofollow">Show Source</a>
  </div>
<div class="this-page-menu">
  <a href="/scipy/docs/scipy-docs/tutorial.gensim.rst">Edit page</a>
</div>

        </div>
      </div>
        </div>
      </div>
    </div>

    <div class="container container-navbar-bottom">
      <div class="spc-navbar">
        
      </div>
    </div>
    <div class="container">
    <div class="footer">
    <div class="row-fluid">
    <ul class="inline pull-left">
      <li>
        &copy; Copyright 2015, ASU Digital Innovation Group.
      </li>
      <li>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.4.5.
      </li>
    </ul>
    </div>
    </div>
    </div>
  </body>
</html>